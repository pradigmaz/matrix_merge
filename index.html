<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matrix Merge</title>
    <link rel="stylesheet" href="style.css">
    <script type="importmap">
    {
      "imports": {
        "three": "./js/three.module.min.js",
        "three/addons/": "./js/"
      }
    }
    </script>
</head>
<body>
    <div class="game-container">
        <!-- Граница игрового поля -->
        <div class="game-border"></div>
        
        <!-- Матричный фоновый дождь -->
        <canvas id="matrix-bg"></canvas>
        
        <!-- Основной игровой канвас -->
        <canvas id="game-canvas"></canvas>
        
        <!-- Верхняя граница поражения -->
        <div class="death-line"></div>
        
        <!-- Игровой интерфейс -->
        <div class="ui-container">
            <div class="score-container">
                <span class="score-label">Счет:</span>
                <span id="score">0</span>
            </div>
            
            <div class="settings-button" id="settings-toggle">
                <span class="neon-text">⚙</span>
            </div>
        </div>
        
        <!-- Панель настроек (скрыта по умолчанию) -->
        <div class="settings-panel" id="settings-panel">
            <h2 class="neon-text">Настройки</h2>
            <div class="settings-row">
                <label for="music-volume" class="neon-text">Музыка:</label>
                <input type="range" id="music-volume" min="0" max="100" value="50">
            </div>
            <div class="settings-row">
                <label for="color-scheme" class="neon-text">Цветовая схема:</label>
                <select id="color-scheme">
                    <option value="matrix">Матрица</option>
                    <option value="cyber">Кибер</option>
                    <option value="neon">Неон</option>
                    <option value="retro">Ретро</option>
                    <option value="gold">Золотой</option>
                    <option value="space">Космос</option>
                </select>
            </div>
        </div>
        
        <!-- Бонусы -->
        <div class="bonuses-container">
            <div class="bonus-button" id="disintegration">
                <span class="neon-text">Дезинтеграция</span>
                <div class="cooldown-overlay" id="disintegration-cooldown"></div>
            </div>
            <div class="bonus-button" id="bomb">
                <span class="neon-text">Бомба</span>
                <div class="cooldown-overlay" id="bomb-cooldown"></div>
            </div>
        </div>
        
        <!-- Игровые оверлеи -->
        <div class="overlay" id="start-overlay">
            <h1 class="neon-text">Matrix Merge</h1>
            <button class="neon-button" id="start-button">Начать игру</button>
        </div>
        
        <div class="overlay" id="game-over-overlay">
            <h2 class="neon-text">Игра окончена</h2>
            <div class="score-display">
                <span class="neon-text">Ваш счет:</span>
                <span id="final-score" class="neon-text">0</span>
            </div>
            <button class="neon-button" id="continue-button">Продолжить</button>
            <button class="neon-button" id="restart-button">Начать заново</button>
        </div>
    </div>
    
    <!-- Подключение скриптов -->
    <script src="js/physics.js"></script>
    <script src="js/effects.js" type="module"></script>
    <script>
        // Ожидаем загрузки модуля effects.js, прежде чем загружать остальные скрипты
        window.addEventListener('DOMContentLoaded', function() {
            // Небольшая задержка для уверенности, что MatrixEffect доступен
            setTimeout(function() {
                if (!window.MatrixEffect) {
                    console.error('MatrixEffect не загружен. Проверьте консоль на наличие ошибок.');
                }
            }, 500);
        });
    </script>
    <script src="js/audio.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/ads.js"></script>
    <script src="js/game.js"></script>
</body>
</html>